# ТЗ: Парсинг PDF заданий ОГЭ

## Общая информация

**Цель:** Создать базу заданий ОГЭ по математике на основе PDF файлов из задачника Ширяевой "ОГЭ 2026".

**Количество файлов:** 25 PDF файлов
**Исполнители:** 5 агентов Claude (по 5 файлов каждый)
**Формат результата:** JSON файлы + изображения

---

## Распределение файлов по агентам

### Агент 1: Задания 06-10
| № | Файл | Тема |
|---|------|------|
| 06 | ОГЭ 2026 Задание №06 | Дроби и степени |
| 07 | ОГЭ 2026 Задание №07 | Числа, координатная прямая |
| 08 | ОГЭ 2026 Задание №08 | Алгебраические выражения |
| 09 | ОГЭ 2026 Задание №09 | Уравнения |
| 10 | ОГЭ 2026 Задание №10 | Неравенства |

**Примечание:** Задания 06 и 07 уже готовы, можно использовать как образец.

### Агент 2: Задания 11-15
| № | Файл | Тема |
|---|------|------|
| 11 | ОГЭ 2026 Задание №11 | Последовательности и прогрессии |
| 12 | ОГЭ 2026 Задание №12 | Преобразование выражений |
| 13 | ОГЭ 2026 Задание №13 | Функции и графики |
| 14 | ОГЭ 2026 Задание №14 | Линейные уравнения/неравенства |
| 15 | ОГЭ 2026 Задание №15 | Треугольники |

### Агент 3: Задания 16-20
| № | Файл | Тема |
|---|------|------|
| 16 | ОГЭ 2026 Задание №16 | Окружность |
| 17 | ОГЭ 2026 Задание №17 | Четырёхугольники |
| 18 | ОГЭ 2026 Задание №18 | Площади фигур |
| 19 | ОГЭ 2026 Задание №19 | Геометрия на клетчатой бумаге |
| 20 | ОГЭ 2026 Задание №20 | Геометрические утверждения |

### Агент 4: Задания 21-25
| № | Файл | Тема |
|---|------|------|
| 21 | ОГЭ 2026 Задание №21 | Задачи повышенной сложности |
| 22 | ОГЭ 2026 Задание №22 | Задачи повышенной сложности |
| 23 | ОГЭ 2026 Задание №23 | Задачи повышенной сложности |
| 24 | ОГЭ 2026 Задание №24 | Задачи повышенной сложности |
| 25 | ОГЭ 2026 Задание №25 | Задачи повышенной сложности |

### Агент 5: Комплексные задания 01-05
| № | Файл | Контекст |
|---|------|----------|
| 01-05 | Квартира | Практические задачи |
| 01-05 | Тарифы | Практические задачи |
| 01-05 | Участок | Практические задачи |
| 01-05 | План местности | Практические задачи |
| 01-05 | Шины | Практические задачи |

*Дополнительно можно взять: Листы бумаги, Печь для бани*

---

## Формат выходных данных

### Структура JSON файла

```json
{
  "topic_id": "08",
  "title": "Алгебраические выражения",
  "description": "Упрощение алгебраических выражений, работа со степенями",
  "created_at": "2026-01-06",
  "author": "Claude Agent 1",
  "structured_blocks": [
    {
      "number": 1,
      "title": "ФИПИ",
      "zadaniya": [
        {
          "number": 1,
          "instruction": "Найдите значение выражения",
          "type": "expression",
          "tasks": [
            {
              "id": 1,
              "expression": "\\frac{a^2 - b^2}{a + b}",
              "image": null
            },
            {
              "id": 2,
              "expression": "(x + 3)^2 - 6x",
              "image": null
            }
          ]
        },
        {
          "number": 2,
          "instruction": "Какое из утверждений верно?",
          "type": "choice",
          "tasks": [
            {
              "id": 1,
              "image": "img-000.png",
              "options": [
                "$a > 0$",
                "$a < 0$",
                "$a = 0$",
                "$a \\neq 0$"
              ],
              "correct": 0
            }
          ]
        }
      ]
    },
    {
      "number": 2,
      "title": "Расширенная версия",
      "zadaniya": []
    }
  ]
}
```

### Типы заданий (type)

| Тип | Описание | Поля задачи |
|-----|----------|-------------|
| `expression` | Вычислить выражение | `expression` (LaTeX) |
| `choice` | Выбор из 4 вариантов | `options[]`, `image?`, `correct?` |
| `interval` | Между какими числами | `expression`, `options[]` |
| `matching` | Соответствие | `items[]`, `matches[]` |
| `ordering` | Расположить по порядку | `items[]` |
| `open` | Свободный ответ | `expression?`, `answer_hint?` |

### LaTeX форматирование

**Дроби:**
```latex
\frac{3}{4}           → 3/4
\frac{a + b}{c - d}   → (a+b)/(c-d)
```

**Степени:**
```latex
x^2, x^{10}, a^{n+1}
```

**Корни:**
```latex
\sqrt{2}, \sqrt[3]{8}, \sqrt{a^2 + b^2}
```

**Индексы:**
```latex
a_1, x_{n+1}
```

**Специальные символы:**
```latex
\cdot (умножение), \leq, \geq, \neq, \pm
```

**Десятичные числа:**
```latex
3{,}14  (запятая как разделитель)
```

---

## Пошаговая инструкция для агента

### Шаг 1: Извлечение PDF из git

```bash
# Пример для задания 08
git show b8c1426:"РиР_ ОГЭ (тренажер)/ОГЭ 2026 Задание №08 (трен).pdf" > storage/app/pdf/task_08.pdf
```

### Шаг 2: Извлечение текста

```bash
pdftotext -layout storage/app/pdf/task_08.pdf storage/app/pdf/task_08.txt
```

### Шаг 3: Извлечение изображений

```bash
mkdir -p public/images/tasks/08
pdfimages -png storage/app/pdf/task_08.pdf public/images/tasks/08/img
```

### Шаг 4: Анализ структуры

1. Открыть `task_08.txt`
2. Найти все "Блок N. Название"
3. Найти все "Задание N. Инструкция"
4. Определить тип каждого задания
5. Извлечь варианты ответов

### Шаг 5: Создание JSON

1. Создать файл `storage/app/parsed/topic_08.json`
2. Заполнить структуру по шаблону выше
3. Конвертировать математические выражения в LaTeX
4. Связать изображения с задачами

### Шаг 6: Создание страницы

Добавить в `TestPdfController.php`:
1. Метод `topic08()`
2. Метод `getAllBlocksData08()`
3. Создать view `resources/views/test/topic08.blade.php`
4. Добавить route в `routes/web.php`

### Шаг 7: Проверка

1. Открыть `/test/8` в браузере
2. Проверить отображение всех заданий
3. Проверить рендеринг LaTeX формул
4. Проверить отображение изображений

---

## Образцы готовой работы

### Файлы для изучения:

1. **Контроллер с данными:**
   - `app/Http/Controllers/TestPdfController.php`
   - Методы: `getAllBlocksData()` (topic 06), `getAllBlocksData07()` (topic 07)

2. **View шаблоны:**
   - `resources/views/test/topic06.blade.php`
   - `resources/views/test/topic07.blade.php`

3. **Готовые страницы:**
   - `/test/6` - пример с выражениями (expression)
   - `/test/7` - пример с изображениями и выбором (choice)

### Пример данных topic 06:

```php
[
    'number' => 1,
    'title' => 'ФИПИ',
    'zadaniya' => [
        [
            'number' => 1,
            'instruction' => 'Найдите значение выражения',
            'tasks' => [
                ['id' => 1, 'expression' => '\\frac{3}{4} \\cdot \\frac{6}{5}'],
                ['id' => 2, 'expression' => '\\frac{21}{5} \\cdot \\frac{3}{7}'],
                // ...
            ]
        ],
    ]
]
```

### Пример данных topic 07:

```php
[
    'number' => 1,
    'title' => 'ФИПИ',
    'zadaniya' => [
        [
            'number' => 1,
            'instruction' => 'На координатной прямой отмечено число a...',
            'type' => 'choice',
            'tasks' => [
                [
                    'id' => 1,
                    'image' => 'img-000.png',
                    'options' => ['$a - 6 < 0$', '$6 - a > 0$', '$a - 7 > 0$', '$8 - a < 0$']
                ],
                // ...
            ]
        ],
    ]
]
```

---

## Важные замечания

### Автоматический парсер НЕ работает

Автоматический парсер (`AdvancedPdfParser`) не справляется из-за:
- Дроби в PDF как числитель/знаменатель на разных строках
- Сложные математические выражения
- Разный формат в разных PDF

**Требуется ручная работа** - чтение PDF и создание структурированных данных.

### Приоритеты при парсинге

1. **Точность важнее скорости** - лучше меньше заданий, но правильных
2. **LaTeX должен рендериться** - проверять в браузере
3. **Изображения должны соответствовать** - правильный маппинг

### Коммуникация между агентами

После завершения работы каждый агент должен:
1. Создать PR или закоммитить в свою ветку
2. Обновить статус в `CLAUDE.md` (таблица заданий)
3. Оставить комментарий о проблемах/особенностях

---

## Команды Git

```bash
# Получить PDF из истории
git show b8c1426:"РиР_ ОГЭ (тренажер)/ОГЭ 2026 Задание №08 (трен).pdf" > storage/app/pdf/task_08.pdf

# Список всех PDF в коммите
git show b8c1426 --name-only | grep pdf

# Создать ветку для работы
git checkout -b feature/topic-08-parsing

# Коммит
git add -A && git commit -m "feat: Add topic 08 task data and page"

# Push
git push -u origin feature/topic-08-parsing
```

---

## Чек-лист для каждого задания

- [ ] PDF извлечён из git
- [ ] Текст извлечён (pdftotext)
- [ ] Изображения извлечены (pdfimages)
- [ ] JSON создан с правильной структурой
- [ ] Все блоки добавлены
- [ ] Все задания добавлены
- [ ] LaTeX выражения корректны
- [ ] Изображения связаны с задачами
- [ ] Метод в контроллере создан
- [ ] View создан
- [ ] Route добавлен
- [ ] Страница открывается в браузере
- [ ] Формулы рендерятся правильно
- [ ] Изображения отображаются
- [ ] Статус обновлён в CLAUDE.md
- [ ] Изменения закоммичены и запушены
